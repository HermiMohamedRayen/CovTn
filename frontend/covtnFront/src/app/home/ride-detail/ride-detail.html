<div class="max-w-2xl mx-auto p-5 bg-white rounded-2xl shadow-lg border border-gray-100">

    <!-- DRIVER HEADER -->
    <div class="flex items-center gap-4 pb-4 border-b" (click)="viewDriverDetail()" *ngIf="ride()?.driver?.email" >
        <img *ngIf="ride()?.driver?.photoUrl" [src]="ride().driver.photoUrl" alt="Driver photo"
            class="w-20 h-20 rounded-full object-cover border shadow-sm" />

        <div class="flex flex-col">
            <span class="text-xl font-semibold">{{ ride()?.driver?.firstName }} {{ ride()?.driver?.lastName }}</span>
        </div>
    </div>

    <!-- TRIP INFO -->
    <div class="mt-5 space-y-4">
        <div>
            <div class="grid grid-cols-2 gap-3 text-sm">

                <div class="flex flex-col bg-gray-50 p-3 rounded-lg">
                    <span class="font-medium"><i class="bi bi-pin-fill" style="color: red;"></i> Departure</span>
                    <span class="text-gray-600">
                        {{depart()}}
                    </span>
                </div>

                <div class="flex flex-col bg-gray-50 p-3 rounded-lg">
                    <span class="font-medium"><i class="bi bi-pin-fill" style="color: blue;"></i> Destination</span>
                    <span class="text-gray-600">
                        {{dest()}}
                    </span>
                </div>

                <div class="flex flex-col bg-gray-50 p-3 rounded-lg">
                    <span class="font-medium"><i class="bi bi-clock" style="color: red;"></i> Departs</span>
                    <span class="text-gray-600">{{ ride()?.departureTime | date:'yyyy-MM-dd HH:mm' }}</span>
                </div>

                <div class="flex flex-col bg-gray-50 p-3 rounded-lg">
                    <span class="font-medium"><i class="bi bi-clock" style="color: blue;"></i> Arrives</span>
                    <span class="text-gray-600">{{ ride()?.arrivalTime | date:'yyyy-MM-dd HH:mm' }}</span>
                </div>
            </div>
        </div>

        <div
      class="p-3 rounded-xl text-center"
      [ngClass]="ride()?.approved ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
    >
      {{ ride()?.approved ? 'âœ” Approved Ride' : 'â›” Waiting for Approval' }}
    </div>

        <!-- MAP SECTION -->
        <div class="mt-4">
            <h3 class="text-lg font-semibold mb-2">Map</h3>
            <div id="map-container" class="w-full h-72 rounded-xl border border-gray-300 bg-gray-100 shadow-inner">
                <div id="map" class="w-full h-full rounded-xl"></div>
            </div>
        </div>

        <div class="w-full bg-white rounded-2xl shadow-md border p-6 space-y-4 animate-slide-up">
            <!-- Comments Header -->
            <div class="flex items-center justify-between mb-4 pb-4 border-b">
                <div class="flex items-center gap-3">
                    <h3 class="text-xl font-bold">ðŸ’¬ Reviews & Comments</h3>
                    <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold">
                        {{ comments().length }}
                    </span>
                </div>
                <div *ngIf="comments().length > 0" class="flex items-center gap-2 text-amber-500">
                    <i class="bi bi-star-fill"></i>
                    <span class="font-semibold">{{ getAverageRating() }}/5</span>
                </div>
            </div>

            <!-- Comments List -->
            <div class="max-h-96 overflow-y-auto space-y-3 mb-4 pr-2 custom-scrollbar">
                <div *ngIf="comments().length === 0" class="text-center py-8">
                    <i class="bi bi-chat-left text-4xl text-gray-300 mb-2 block"></i>
                    <p class="text-gray-400 font-medium">No comments yet</p>
                    <p class="text-gray-500 text-sm">Be the first to share your experience!</p>
                </div>
                
                <div *ngFor="let comment of comments()" class="p-4 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 hover:shadow-md transition-all duration-300 animate-fade-in">
                    <!-- User Info -->
                    <div class="flex items-start gap-3 mb-3">
                        <img [src]="'https://ui-avatars.com/api/?name=' + comment.user?.firstName + '+' + comment.user?.lastName + '&background=667eea&color=fff'" 
                            alt="{{ comment.user?.firstName }}"
                            class="w-10 h-10 rounded-full border-2 border-blue-300 flex-shrink-0" />
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between gap-2">
                                <span class="font-semibold text-gray-800">
                                    {{ comment.user?.firstName }} {{ comment.user?.lastName }}
                                </span>
                                <span class="text-xs text-gray-500">{{ comment.createdAt | date:'short' }}</span>
                            </div>
                            <!-- Stars -->
                            <div class="flex items-center gap-0.5 mt-1">
                                <span *ngFor="let star of [1,2,3,4,5]" 
                                    class="text-lg"
                                    [ngClass]="star <= comment.rating ? 'text-amber-400' : 'text-gray-300'">
                                    â˜…
                                </span>
                                <span class="text-xs text-gray-600 ml-1 font-medium">{{ comment.rating }}.0</span>
                            </div>
                        </div>
                    </div>
                    <!-- Comment Text -->
                    <p class="text-gray-700 text-sm leading-relaxed">{{ comment.text }}</p>
                </div>
            </div>

            <!-- Add Comment Form -->
            <form [formGroup]="commentForm" (ngSubmit)="submitComment()" class="border-t pt-4 space-y-4">
                <h4 class="text-base font-semibold text-gray-800 flex items-center gap-2">
                    <i class="bi bi-pencil-square text-blue-600"></i>
                    Leave Your Review
                </h4>
                
                <!-- Rating Selection -->
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Your Rating <span class="text-red-500">*</span></label>
                    <div class="flex items-center gap-2">
                        <select formControlName="rating" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <option *ngFor="let i of [5,4,3,2,1]" [value]="i">
                                {{ i }} {{ i === 1 ? 'Star' : 'Stars' }} - 
                                <span *ngIf="i === 5">Excellent!</span>
                                <span *ngIf="i === 4">Very Good</span>
                                <span *ngIf="i === 3">Good</span>
                                <span *ngIf="i === 2">Fair</span>
                                <span *ngIf="i === 1">Poor</span>
                            </option>
                        </select>
                        <div class="flex gap-0.5">
                            <span *ngFor="let star of [1,2,3,4,5]" 
                                class="text-xl"
                                [ngClass]="star <= commentForm.get('rating')?.value ? 'text-amber-400' : 'text-gray-300'">
                                â˜…
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Comment Textarea -->
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Your Comment <span class="text-red-500">*</span></label>
                    <textarea 
                        formControlName="text"
                        placeholder="Share your experience with this ride... (minimum 5 characters)"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none transition-all placeholder-gray-400"
                        rows="3"></textarea>
                    <div class="flex items-center justify-between mt-2">
                        <div class="flex gap-2">
                            <small *ngIf="commentForm.get('text')?.hasError('required') && commentForm.get('text')?.touched" 
                                class="text-red-500 flex items-center gap-1">
                                <i class="bi bi-exclamation-circle"></i>
                                Comment is required
                            </small>
                            <small *ngIf="commentForm.get('text')?.hasError('minlength') && commentForm.get('text')?.touched" 
                                class="text-red-500 flex items-center gap-1">
                                <i class="bi bi-exclamation-circle"></i>
                                Minimum 5 characters required
                            </small>
                        </div>
                        <small class="text-gray-500">
                            {{ commentForm.get('text')?.value?.length || 0 }}/500
                        </small>
                    </div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit"
                    [disabled]="!commentForm.valid"
                    class="w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 hover:shadow-lg hover:scale-105 flex items-center justify-center gap-2">
                    <i class="bi bi-send-fill"></i>
                    Post Review
                </button>
            </form>
        </div>


    </div>
</div>